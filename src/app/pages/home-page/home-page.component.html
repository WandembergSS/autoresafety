<section class="page">
  <header class="page__header">
    <h2>SafeSecIoT Project Workspace</h2>
    <p>
      Coordinate SafeSecIoT Canvas capture and the 7-step RESafety workflow for every safety-critical system under analysis.
    </p>
  </header>

  <div class="page__grid">
    <form class="card" [formGroup]="projectForm" (ngSubmit)="createProject()">
      <h3>Kick off a new analysis</h3>
      <div class="field">
        <label for="project-name">Project name</label>
        <input
          id="project-name"
          type="text"
          formControlName="name"
          placeholder="e.g. Automated Insulin Delivery (AID) System"
        />
        @if (projectForm.controls.name.invalid && projectForm.controls.name.touched) {
          <small class="hint">Provide a descriptive name (min. 4 characters).</small>
        }
      </div>

      <div class="field">
        <label for="project-domain">Operational domain</label>
        <input
          id="project-domain"
          type="text"
          formControlName="domain"
          placeholder="e.g. Medical IoT, Urban Mobility, Aviation"
        />
      </div>

      <div class="field">
        <label for="project-owner">Lead analyst</label>
        <input
          id="project-owner"
          type="text"
          formControlName="owner"
          placeholder="Assign the RESafety facilitator"
        />
      </div>

      <div class="field">
        <label for="project-description">Mission overview</label>
        <textarea
          id="project-description"
          rows="3"
          formControlName="description"
          placeholder="Summarise mission intent, key stakeholders, and why the analysis matters."
        ></textarea>
      </div>

      <button type="submit" class="primary">Create project charter</button>
    </form>

    <section class="card card--summary">
      <h3>7-step RESafety timeline</h3>
      <ol>
        <li>Define SCS scope via the SafeSecIoT Canvas (mission, hazards, constraints).</li>
        <li>Refine iStar4Safety models to map actors, goals, and responsibilities.</li>
        <li>Derive the STPA control structure and feedback architecture.</li>
        <li>Evaluate control actions across STPA contexts to expose UCAs.</li>
        <li>Translate UCAs into controller constraints and assurance checks.</li>
        <li>Analyse loss scenarios and author safety requirements for mitigation.</li>
        <li>Update iStar4Safety artefacts and log evidence for traceability.</li>
      </ol>
    </section>
  </div>

  <section class="list">
    <header class="list__header">
      <h3>In-flight analyses</h3>
      <p>{{ pendingProjects().length }} active SafeSecIoT projects</p>
    </header>

    @if (pendingProjects().length === 0) {
        <p class="empty">No pending analyses. Create a charter to start the SafeSecIoT Canvas.</p>
    } @else {
      <div class="list__grid">
        @for (project of pendingProjects(); track project.id) {
          <article class="tile">
            <div class="tile__heading">
              <h4>{{ project.name }}</h4>
              <span class="status status--{{ project.status }}">{{ project.status }}</span>
            </div>
            <p class="tile__meta">
              <strong>Domain:</strong> {{ project.domain }} · <strong>Lead analyst:</strong>
              {{ project.owner ?? 'Unassigned' }}
            </p>
            <p class="tile__description">{{ project.description }}</p>
            <p class="tile__next">
              Current stage: Step {{ project.currentStep ?? '—' }} · {{ project.nextStep }}
            </p>
            <div class="tile__actions">
              <button type="button" (click)="updateStatus(project.id, 'in-progress')">Mark in-progress</button>
              <button type="button" (click)="updateStatus(project.id, 'complete')">Mark complete</button>
              <button type="button" class="danger" (click)="removeProject(project.id)">Remove</button>
            </div>
          </article>
        }
      </div>
    }
  </section>

  <section class="list">
    <header class="list__header">
      <h3>Concluded analyses</h3>
      <p>{{ completedProjects().length }} archived traceability packages</p>
    </header>

    @if (completedProjects().length === 0) {
      <p class="empty">No completed projects yet. Finish a workflow to see history here.</p>
    } @else {
      <div class="list__grid list__grid--compact">
        @for (project of completedProjects(); track project.id) {
          <article class="tile tile--compact">
              <div class="tile__heading">
                <h4>{{ project.name }}</h4>
                <span class="status status--complete">Complete</span>
              </div>
              <p class="tile__meta">
                <strong>Domain:</strong> {{ project.domain }} · <strong>Lead analyst:</strong>
                {{ project.owner ?? 'Unassigned' }}
              </p>
              <p class="tile__description">{{ project.description }}</p>
              <div class="tile__actions">
                <button type="button" (click)="updateStatus(project.id, 'pending')">Reopen</button>
                <button type="button" class="danger" (click)="removeProject(project.id)">Remove</button>
              </div>
          </article>
        }
      </div>
    }
  </section>
</section>
